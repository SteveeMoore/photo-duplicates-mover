# photo-dupes-mover

CLI-утилита для поиска **дубликатов изображений по содержимому** и автоматического переноса дубликатов в отдельную папку `Dublicates` внутри каталога с изображениями.

Проект подходит для чистки больших архивов фотографий (включая HEIC с iPhone).

---

## Возможности

- Поиск **точных дубликатов** (бит-в-бит) по SHA-256  
- Поиск **визуально похожих изображений** (perceptual hash, dHash)  
- Комбинированный режим: сначала exact → затем visual  
- Автоматическое перемещение дубликатов в папку `Dublicates`  
- Корректная работа с EXIF-поворотами  
- Dry-run режим (ничего не переносит, только показывает)  
- Рекурсивный обход папок  
- Поддержка большинства форматов изображений через Pillow  
- Progress bar в консоли (проценты)

---

## Поддерживаемые форматы

Поддерживаются **все форматы, которые может открыть Pillow**, включая:

- JPG / JPEG  
- PNG  
- WEBP  
- BMP  
- TIFF  
- GIF  
- HEIC / HEIF *(через `pillow-heif`)*  
- AVIF *(если поддерживается сборкой Pillow)*  

> ⚠️ Важно:\
> Визуальный поиск (dHash) — эвристика. Возможны ложные совпадения.\
> В режиме `visual` (dHash) дубликатами считаются **визуально похожие изображения**.\
> Используйте `--dry-run`, если хотите предварительно проверить,
> какие файлы будут перенесены.\
> Сравнение изображений с текстом работает хуже.

---

## Установка

### 1) Клонировать репозиторий

```bash
git clone https://github.com/<your-username>/photo-dupes-mover.git
cd photo-dupes-mover
```
### 2) Создать виртуальное окружение
```bash
python -m venv .venv
source .venv/bin/activate      # Linux / macOS
.venv\Scripts\activate         # Windows
```
### 3) Установить зависимости
```bash
pip install -r requirements.txt
```

### Проверка поддержки HEIC
```bash
python -c "import pillow_heif; pillow_heif.register_heif_opener(); print('HEIC support OK')"
```

## Использование
### 1) Поиск точных дубликатов (по умолчанию)
```bash
python -m photo_dupes.mover "./photos"
```
### 2) Рекурсивный обход
```bash
python -m photo_dupes.mover "./photos" --recursive
```
### 3) Поиск визуальных дубликатов (dHash)
Строго (почти одинаковые картинки):
```bash
python -m photo_dupes.mover "./photos" --mode visual --threshold 0
```
Мягче (похожие кадры, серийная съёмка):
```bash
python -m photo_dupes.mover "./photos" --mode visual --threshold 3
```
Рекомендуемые значения --threshold:
- 0–1 — очень строго
- 2–3 — умеренно
- 4–6 — агрессивно (риск ошибок)
### 4) Комбинированный режим (рекомендуется)
```bash
python -m photo_dupes.mover "./photos" --mode both --threshold 2
```
Алгоритм:
1) Сначала удаляются точные дубликаты (SHA-256)
2) Затем визуальные дубликаты среди оставшихся файлов

### 5) Dry-run (без перемещения файлов)
```bash
python -m photo_dupes.mover "./photos" --mode both --threshold 2 --dry-run
```
### 6) Попытаться обработать вообще все файлы
```bash
python -m photo_dupes.mover "./photos" --try-all-files
```

## Как работает перенос

- Все файлы, которые распознаны как дубликаты (exact или visual),
  **полностью переносятся** в папку `Dublicates`.
- В исходной папке **не остаётся ни одного файла-дубликата**.
- Папка `Dublicates` автоматически создаётся внутри целевого каталога.
- Если при переносе возникает конфликт имён, файл автоматически
  переименовывается с добавлением суффикса:
  - `image.jpg`
  - `image_1.jpg`
  - `image_2.jpg`

